!function(){"use strict";function h(){var t,e,i,n=arguments.length,o=arguments[0]||{};for("object"!=typeof o&&"function"!=typeof o&&(o={}),1==n&&(o=this,t--),t=1;t<n;t++)for(i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(o[i]=e[i]);return o}function p(t){return"function"==typeof t&&"number"!=typeof t.nodeType}function i(t,e){this.$element=t,this.options=h({},i.DEFAULTS,e),this.$element.style.position="relative",this.$element.style.width=this.options.width+"px",this.$element.style.margin="0 auto",this.init()}var t;i.VERSION="1.0",i.Author="argo@163.com",i.DEFAULTS={width:280,height:155,PI:Math.PI,sliderL:42,sliderR:9,offset:5,loadingText:"正在加载中...",failedText:"再试一次",barText:"向右滑动填充拼图",repeatIcon:"fa fa-repeat",maxLoadCount:3,localImages:function(){return"images/Pic"+Math.round(4*Math.random())+".jpg"},verify:function(t,e){var i=!1;return $.ajax({url:e,data:{datas:JSON.stringify(t)},dataType:"json",type:"post",async:!1,success:function(t){i=JSON.stringify(t),console.log("返回结果："+i)}}),i},remoteUrl:null},window.sliderCaptcha=function(t){var e=document.getElementById(t.id);return new i(e,"object"==typeof t&&t)},(t=(window.sliderCaptcha.Constructor=i).prototype).init=function(){this.initDOM(),this.initImg(),this.bindEvents()},t.initDOM=function(){function t(t,e){return(t=document.createElement(t)).className=e,t}i=this.options.width-2,n=this.options.height,(o=document.createElement("canvas")).width=i,o.height=n;var e,i=o,n=i.cloneNode(!0),o=t("div","sliderContainer"),s=t("i","refreshIcon "+this.options.repeatIcon),r=t("div","sliderMask"),a=t("div","sliderbg"),l=t("div","slider"),d=t("i","fa fa-arrow-right sliderIcon"),c=t("span","sliderText");n.className="block",c.innerHTML=this.options.barText,(e=this.$element).appendChild(i),e.appendChild(s),e.appendChild(n),l.appendChild(d),r.appendChild(l),o.appendChild(a),o.appendChild(r),o.appendChild(c),e.appendChild(o),a={canvas:i,block:n,sliderContainer:o,refreshIcon:s,slider:l,sliderMask:r,sliderIcon:d,text:c,canvasCtx:i.getContext("2d"),blockCtx:n.getContext("2d")},p(Object.assign)?Object.assign(this,a):h(this,a)},t.initImg=function(){function i(t,e){var i=a.options.sliderL,n=a.options.sliderR,o=a.options.PI,s=a.x,r=a.y;t.beginPath(),t.moveTo(s,r),t.arc(s+i/2,r-n+2,n,.72*o,2.26*o),t.lineTo(s+i,r),t.arc(s+i+n-2,r+i/2,n,1.21*o,2.78*o),t.lineTo(s+i,r+i),t.lineTo(s,r+i),t.arc(s+n-2,r+i/2,n+.4,2.76*o,1.24*o,!0),t.lineTo(s,r),t.lineWidth=2,t.fillStyle="rgba(255, 255, 255, 0.7)",t.strokeStyle="rgba(255, 255, 255, 0.7)",t.stroke(),t[e](),t.globalCompositeOperation=l?"xor":"destination-over"}function n(t,e){return Math.round(Math.random()*(e-t)+t)}var o,a=this,l=-1<window.navigator.userAgent.indexOf("Trident"),s=this.options.sliderL+2*this.options.sliderR+3,r=new Image;r.crossOrigin="Anonymous",o=0,r.onload=function(){a.x=n(s+10,a.options.width-(s+10)),a.y=n(10+2*a.options.sliderR,a.options.height-(s+10)),i(a.canvasCtx,"fill"),i(a.blockCtx,"clip"),a.canvasCtx.drawImage(r,0,0,a.options.width-2,a.options.height),a.blockCtx.drawImage(r,0,0,a.options.width-2,a.options.height);var t=a.y-2*a.options.sliderR-1,e=a.blockCtx.getImageData(a.x-3,t,s,s);a.block.width=s,a.blockCtx.putImageData(e,0,1+t),a.text.textContent=a.text.getAttribute("data-text")},r.onerror=function(){o++,"file:"===window.location.protocol&&(o=a.options.maxLoadCount,console.error("can't load pic resource file from File protocal. Please try http or https")),o>=a.options.maxLoadCount?(a.text.textContent="加载失败",a.classList.add("text-danger")):r.src=a.options.localImages()},r.setSrc=function(){var t,e="";o=0,a.text.classList.remove("text-danger"),(e=p(a.options.setSrc)?a.options.setSrc():e)&&""!==e||(e="https://picsum.photos/"+a.options.width+"/"+a.options.height+"/?image="+Math.round(20*Math.random())),l?((t=new XMLHttpRequest).onloadend=function(t){var e=new FileReader;e.readAsDataURL(t.target.response),e.onloadend=function(t){r.src=t.target.result}},t.open("GET",e),t.responseType="blob",t.send()):r.src=e},r.setSrc(),this.text.setAttribute("data-text",this.options.barText),this.text.textContent=this.options.loadingText,this.img=r},t.clean=function(){this.canvasCtx.clearRect(0,0,this.options.width,this.options.height),this.blockCtx.clearRect(0,0,this.options.width,this.options.height),this.block.width=this.options.width},t.bindEvents=function(){var n=this;this.$element.addEventListener("selectstart",function(){return!1}),this.refreshIcon.addEventListener("click",function(){n.text.textContent=n.options.barText,n.reset(),p(n.options.onRefresh)&&n.options.onRefresh.call(n.$element)});function t(t){n.text.classList.contains("text-danger")||(o=t.clientX||t.touches[0].clientX,s=t.clientY||t.touches[0].clientY,a=!0)}function e(t){var e,i;return!(!a||(i=t.clientX||t.touches[0].clientX,t=(t.clientY||t.touches[0].clientY)-s,(i=i-o)<0)||40+i>n.options.width)&&(n.slider.style.left=i-1+"px",e=(n.options.width-60)/(n.options.width-40)*i,n.block.style.left=e+"px",n.sliderContainer.classList.add("sliderContainer_active"),n.sliderMask.style.width=4+i+"px",void r.push(Math.round(t)))}function i(t){if(!a||(a=!1,(t.clientX||t.changedTouches[0].clientX)===o))return!1;n.sliderContainer.classList.remove("sliderContainer_active"),n.trail=r,(t=n.verify()).spliced&&t.verified?(n.sliderContainer.classList.add("sliderContainer_success"),p(n.options.onSuccess)&&n.options.onSuccess.call(n.$element)):(n.sliderContainer.classList.add("sliderContainer_fail"),p(n.options.onFail)&&n.options.onFail.call(n.$element),setTimeout(function(){n.text.innerHTML=n.options.failedText,n.reset()},1e3))}var o,s,r=[],a=!1;this.slider.addEventListener("mousedown",t),this.slider.addEventListener("touchstart",t),document.addEventListener("mousemove",e),document.addEventListener("touchmove",e),document.addEventListener("mouseup",i),document.addEventListener("touchend",i),document.addEventListener("mousedown",function(){return!1}),document.addEventListener("touchstart",function(){return!1}),document.addEventListener("swipe",function(){return!1})},t.verify=function(){var t,e,i,n=this.trail,o=parseInt(this.block.style.left),s=!1;return s=null!==this.options.remoteUrl?this.options.verify(n,this.options.remoteUrl):(e=n.reduce(t=function(t,e){return t+e})/n.length,i=n.map(function(t){return t-e}),0!==Math.sqrt(i.map(function(t){return t*t}).reduce(t)/n.length)),{spliced:Math.abs(o-this.x)<this.options.offset,verified:s}},t.reset=function(){this.sliderContainer.classList.remove("sliderContainer_fail"),this.sliderContainer.classList.remove("sliderContainer_success"),this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.clean(),this.text.setAttribute("data-text",this.text.textContent),this.text.textContent=this.options.loadingText,this.img.setSrc()}}();