!function(){"use strict";function h(){var t=arguments.length,e=arguments[0]||{};"object"!=typeof e&&"function"!=typeof e&&(e={}),1==t&&(e=this,i--);for(var i=1;i<t;i++){var n,o=arguments[i];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}function p(t){return"function"==typeof t&&"number"!=typeof t.nodeType}function i(t,e){this.$element=t,this.options=h({},i.DEFAULTS,e),this.$element.style.position="relative",this.$element.style.width=this.options.width+"px",this.$element.style.margin="0 auto",this.init()}i.VERSION="1.0",i.Author="argo@163.com",i.DEFAULTS={width:280,height:155,PI:Math.PI,sliderL:42,sliderR:9,offset:5,loadingText:"正在加载中...",failedText:"再试一次",barText:"向右滑动填充拼图",repeatIcon:"fa fa-repeat",maxLoadCount:3,localImages:function(){return"images/Pic"+Math.round(4*Math.random())+".jpg"},verify:function(t,e){var i=!1;return $.ajax({url:e,data:{datas:JSON.stringify(t)},dataType:"json",type:"post",async:!1,success:function(t){i=JSON.stringify(t),console.log("返回结果："+i)}}),i},remoteUrl:null},window.sliderCaptcha=function(t){var e=document.getElementById(t.id);return new i(e,"object"==typeof t&&t)};var t=(window.sliderCaptcha.Constructor=i).prototype;t.init=function(){this.initDOM(),this.initImg(),this.bindEvents()},t.initDOM=function(){function t(t,e){return(t=document.createElement(t)).className=e,t}e=this.options.width-2,i=this.options.height,(n=document.createElement("canvas")).width=e,n.height=i;var e=n,i=e.cloneNode(!0),n=t("div","sliderContainer"),o=t("i","refreshIcon "+this.options.repeatIcon),s=t("div","sliderMask"),r=t("div","sliderbg"),a=t("div","slider"),l=t("i","fa fa-arrow-right sliderIcon"),d=t("span","sliderText"),c=(i.className="block",d.innerHTML=this.options.barText,this.$element),r=(c.appendChild(e),c.appendChild(o),c.appendChild(i),a.appendChild(l),s.appendChild(a),n.appendChild(r),n.appendChild(s),n.appendChild(d),c.appendChild(n),{canvas:e,block:i,sliderContainer:n,refreshIcon:o,slider:a,sliderMask:s,sliderIcon:l,text:d,canvasCtx:e.getContext("2d"),blockCtx:i.getContext("2d")});p(Object.assign)?Object.assign(this,r):h(this,r)},t.initImg=function(){function i(t,e){var i=a.options.sliderL,n=a.options.sliderR,o=a.options.PI,s=a.x,r=a.y;t.beginPath(),t.moveTo(s,r),t.arc(s+i/2,r-n+2,n,.72*o,2.26*o),t.lineTo(s+i,r),t.arc(s+i+n-2,r+i/2,n,1.21*o,2.78*o),t.lineTo(s+i,r+i),t.lineTo(s,r+i),t.arc(s+n-2,r+i/2,n+.4,2.76*o,1.24*o,!0),t.lineTo(s,r),t.lineWidth=2,t.fillStyle="rgba(255, 255, 255, 0.7)",t.strokeStyle="rgba(255, 255, 255, 0.7)",t.stroke(),t[e](),t.globalCompositeOperation=l?"xor":"destination-over"}function n(t,e){return Math.round(Math.random()*(e-t)+t)}var a=this,l=-1<window.navigator.userAgent.indexOf("Trident"),o=this.options.sliderL+2*this.options.sliderR+3,s=new Image,r=(s.crossOrigin="Anonymous",0);s.onload=function(){a.x=n(o+10,a.options.width-(o+10)),a.y=n(10+2*a.options.sliderR,a.options.height-(o+10)),i(a.canvasCtx,"fill"),i(a.blockCtx,"clip"),a.canvasCtx.drawImage(s,0,0,a.options.width-2,a.options.height),a.blockCtx.drawImage(s,0,0,a.options.width-2,a.options.height);var t=a.y-2*a.options.sliderR-1,e=a.blockCtx.getImageData(a.x-3,t,o,o);a.block.width=o,a.blockCtx.putImageData(e,0,1+t),a.text.textContent=a.text.getAttribute("data-text")},s.onerror=function(){r++,"file:"===window.location.protocol&&(r=a.options.maxLoadCount,console.error("can't load pic resource file from File protocal. Please try http or https")),r>=a.options.maxLoadCount?(a.text.textContent="加载失败",a.classList.add("text-danger")):s.src=a.options.localImages()},s.setSrc=function(){var t,e="";r=0,a.text.classList.remove("text-danger"),(e=p(a.options.setSrc)?a.options.setSrc():e)&&""!==e||(e="https://picsum.photos/"+a.options.width+"/"+a.options.height+"/?image="+Math.round(20*Math.random())),l?((t=new XMLHttpRequest).onloadend=function(t){var e=new FileReader;e.readAsDataURL(t.target.response),e.onloadend=function(t){s.src=t.target.result}},t.open("GET",e),t.responseType="blob",t.send()):s.src=e},s.setSrc(),this.text.setAttribute("data-text",this.options.barText),this.text.textContent=this.options.loadingText,this.img=s},t.clean=function(){this.canvasCtx.clearRect(0,0,this.options.width,this.options.height),this.blockCtx.clearRect(0,0,this.options.width,this.options.height),this.block.width=this.options.width},t.bindEvents=function(){var n=this;this.$element.addEventListener("selectstart",function(){return!1}),this.refreshIcon.addEventListener("click",function(){n.text.textContent=n.options.barText,n.reset(),p(n.options.onRefresh)&&n.options.onRefresh.call(n.$element)});function t(t){n.text.classList.contains("text-danger")||(o=t.clientX||t.touches[0].clientX,s=t.clientY||t.touches[0].clientY,a=!0)}function e(t){if(!a)return!1;var e=t.clientX||t.touches[0].clientX,t=(t=t.clientY||t.touches[0].clientY)-s;if((e=e-o)<0||40+e>n.options.width)return!1;n.slider.style.left=e-1+"px";var i=(n.options.width-40-20)/(n.options.width-40)*e;n.block.style.left=i+"px",n.sliderContainer.classList.add("sliderContainer_active"),n.sliderMask.style.width=4+e+"px",r.push(Math.round(t))}function i(t){return!!a&&(a=!1,(t.clientX||t.changedTouches[0].clientX)!==o)&&(n.sliderContainer.classList.remove("sliderContainer_active"),n.trail=r,void((t=n.verify()).spliced&&t.verified?(n.sliderContainer.classList.add("sliderContainer_success"),p(n.options.onSuccess)&&n.options.onSuccess.call(n.$element)):(n.sliderContainer.classList.add("sliderContainer_fail"),p(n.options.onFail)&&n.options.onFail.call(n.$element),setTimeout(function(){n.text.innerHTML=n.options.failedText,n.reset()},1e3))))}var o,s,r=[],a=!1;this.slider.addEventListener("mousedown",t),this.slider.addEventListener("touchstart",t),document.addEventListener("mousemove",e),document.addEventListener("touchmove",e),document.addEventListener("mouseup",i),document.addEventListener("touchend",i),document.addEventListener("mousedown",function(){return!1}),document.addEventListener("touchstart",function(){return!1}),document.addEventListener("swipe",function(){return!1})},t.verify=function(){var t,e,i,n=this.trail,o=parseInt(this.block.style.left),s=!1;return s=null!==this.options.remoteUrl?this.options.verify(n,this.options.remoteUrl):(e=n.reduce(t=function(t,e){return t+e})/n.length,i=n.map(function(t){return t-e}),0!==Math.sqrt(i.map(function(t){return t*t}).reduce(t)/n.length)),{spliced:Math.abs(o-this.x)<this.options.offset,verified:s}},t.reset=function(){this.sliderContainer.classList.remove("sliderContainer_fail"),this.sliderContainer.classList.remove("sliderContainer_success"),this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.clean(),this.text.setAttribute("data-text",this.text.textContent),this.text.textContent=this.options.loadingText,this.img.setSrc()}}();